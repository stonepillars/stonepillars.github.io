var triggerError=attachErrorHandler("flockpanel",!0);$(document).ready(function(){var c={vitals:{},partitions:[],drones:[],enemies:[]},e=["#802020","#FF0000","#FFA200","#FFFB00","#C8FF00","#00FF00"],l=null,r={partitions:[{name:"name",content:"??.?"},{name:"host",content:""},{name:"health",content:100},{name:"jump",action:"jump_to",content:'<i class="icon-map-marker"></i>'},{name:"eject",action:"eject_trace",content:'<i class="icon-eject"></i>',required:"host"},{name:"delete",action:"delete_trace",content:'<i class="icon-ban-circle"></i>'}],drones:[{name:"name",content:"??.??.??"},{name:"health",content:100},{name:"resources",content:0},{name:"task",content:0},{name:"area",content:"Unknown"},{name:"jump",action:"jump_to",content:'<i class="icon-map-marker"></i>'},{name:"rally",action:"rally",content:'<i class="icon-reply-all"></i>'}],enemies:[{name:"name",content:"Unknown"},{name:"area",content:"Unknown"},{name:"remove",action:"remove_enemy",content:'<i class="icon-remove"></i>'}]};function s(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function d(t){return t.slice(3,-1)}function n(t){return t=Math.floor(t),"<span style='color:"+function(t,e,n,a){if(Array.isArray(t)&&!isNaN(e)&&!isNaN(n)&&!isNaN(a)){var r,i,o;a<n&&(i=n,n=a,a=i),o=a;e=((e=(r=e)<=(i=n)?i:o<=r?o:r)-n)/(a-n);if(1<=e)return t[t.length-1];a=e*t.length,n=Math.floor(a),e=a-n,a=s(t[n]),n=s(t[n+1]),e={r:a.r+(n.r-a.r)*e,g:a.g+(n.g-a.g)*e,b:a.b+(n.b-a.b)*e};return"#"+((1<<24)+(Math.floor(e.r)<<16)+(Math.floor(e.g)<<8)+Math.floor(e.b)).toString(16).slice(1)}}(e,t,0,100)+"'>"+t+"%</span>"}function i(s){var t=c[s],n=$("#"+s),a=r[s];$.each(t,function(t,e){var r,i,o,c;e.ref&&(r=d(e.ref),0===(i=$("#"+s+"-"+r)).length&&(i=$("<tr>").attr("id",s+"-"+r)).appendTo(n),$.each(a,function(t,n){var a;0===(o=i.find("."+n.name)).length&&(o=$("<td>").addClass(n.name),i.append(o)),n.action?(0===(c=o.find("#"+s+"-"+n.name+"-"+r)).length&&(c=$("<a>").addClass("button").attr("id",s+"-"+n.name+"-"+r),o.append(c),a="[0x"+r+"]",c.click(function(){var t,e;t=a,e=n.action,window.location="?src="+l+"&action="+e+"&origin="+t}),c.html(n.content)),n.required&&(null!==e[n.required]?c.attr("disabled",!1):c.attr("disabled",!0))):(c=e[n.name]||n.content,o.html(c))}))})}function f(){var t,a;"vitals"===c.tab?(t=$("#vitals"),a=c.vitals,t.find("td.value").each(function(t,e){var n=e.id.split("-")[1];e.innerHTML=void 0!==a[n]?a[n]:"???"})):c[c.tab]&&0<c[c.tab].length&&i(c.tab),$(".health").each(function(){var t=$(this).text();$(this).html(n(parseInt(t)))})}function a(t){$(".tabcontent").hide(),$(".tablinks").removeClass("selected"),$("#tab-button-"+t).addClass("selected"),$("#tab-"+t).show(),c.tab=t,f()}function t(){var n,t=$(this),e=t.attr("id").split("-"),a=e[0],r=c[a],i=e[1],o=c.sort[a],e=-1;o?(void 0!==o[i]&&(e=-1*o[i]),o[i]=e):c.sort[a]={sortOn:e},r=r,n=i,e<0?r.sort(function(t,e){return t[n]<e[n]?-1:e[n]<t[n]?1:0}):r.sort(function(t,e){return t[n]>e[n]?-1:e[n]>t[n]?1:0});a=$("#"+a);a.find("tr:gt(0)").remove(),a.find(".sortable").removeClass("selected asc desc"),t.addClass("selected "+(1===e?"desc":"asc")),f()}function o(){window.location="?src="+l+"&action=update"}function u(n,t){c[n]=[],$.each(t,function(t,e){"object"==typeof e&&c[n].push(e)})}function m(t){var e;if((t=JSON.parse(t))&&t.update)if("flock"===t.update){for(var n in c.vitals={},t.vitals)t.vitals.hasOwnProperty(n)&&(c.vitals[n]=t.vitals[n]);u("drones",t.drones),u("enemies",t.enemies),u("partitions",t.partitions)}else if("add"===t.update){for(var a=c[t.key],r=!1,i=0;i<a.length;++i)if((e=a[i]).ref===t.ref){r=!0,a[i]=t;break}r||a.push(t)}else if("remove"===t.update)for(a=c[t.key],i=0;i<a.length;++i)if((e=a[i]).ref===t.ref){a.splice(i,1);var o=d(e.ref),o=$("#"+t.key+"-"+o);0!==o.length&&o.remove();break}f()}c.sort={},$(".tablinks").click(function(){var t=$(this).attr("id").split("-");a(t[t.length-1])}),f(),a("vitals"),$(".sortable").click(t),l=$("#panel-ref").text(),window.flock={receiveData:m},o(),setInterval(o,3500)});