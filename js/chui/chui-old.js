var escaper=encodeURIComponent||escape,decoder=decodeURIComponent||unescape;window.onerror=function(e,t,o,n,i){return document.location.href.indexOf("proc=debug")<=0&&(n=n?" | column: "+n:"",n+=i?" | error: "+i:"",n="Error: "+e+" | url: "+t+" | line: "+o+(n+=navigator.userAgent?" | user agent: "+navigator.userAgent:""),window.location="?action=ehjax&type=datum&datum=chatOutput&proc=debug&param[error]="+escaper(n)),!0};var setCookie=function(e,t,o){t=escaper(t);var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);n="expires="+n.toUTCString();document.cookie=e+"="+t+"; "+n},getCookie=function(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var i=o[n];" "==i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return decoder(i.substring(t.length,i.length))}return""};$(function(){var e,t,o,n,i={$chuiData:$("#chuiData"),window:null,title:null,content:null,noResize:!1,noMinimize:!1,noClose:!1,offsetX:0,offsetY:0,lastX:null,lastY:null,titlebarMousedown:0,resizeMousedown:0,resizeWorking:!1,minWidth:100,minHeight:100};i.$chuiData.length&&(i.window=$("#chuiData").attr("data-window"),i.title=$("#chuiData").is("[data-title]")?$("#chuiData").attr("data-title"):"",i.noResize=!!$("#chuiData").is("[data-noresize]"),i.noMinimize=!!$("#chuiData").is("[data-nominimize]"),i.noClose=!!$("#chuiData").is("[data-noclose]"),$("#content").nanoScroller({}),i.title.length&&(document.title=i.title,window.status=i.title),e=window,(t=i).offsetX=getCookie("windowOffsetX"),t.offsetY=getCookie("windowOffsetY"),t.offsetX&&t.offsetY||(o=e.screenLeft,n=e.screenTop,e.location="byond://winset?"+t.window+".pos=0,0",t.offsetX=e.screenLeft,t.offsetY=e.screenTop,e.location="byond://winset?"+t.window+".pos="+(o-t.offsetX)+","+(n-t.offsetY),setCookie("windowOffsetX",t.offsetX,1),setCookie("windowOffsetY",t.offsetY,1)),$("body").on("mousemove","#titlebar",function(e){var t,o;e=e||window.event,i.lastX||(i.lastX=e.clientX,i.lastY=e.clientY),1==i.titlebarMousedown?(t=e.clientX-i.lastX,o=e.clientY-i.lastY,i.lastX=e.clientX-t,i.lastY=e.clientY-o,t+=window.screenLeft-i.offsetX,o+=window.screenTop-i.offsetY,window.location="byond://winset?"+i.window+".pos="+t+","+o):(i.lastX=e.clientX,i.lastY=e.clientY)}),$("body").on("mousedown","#titlebar",function(){i.titlebarMousedown=1,$(this)[0].setCapture&&$(this)[0].setCapture()}),$("body").on("mouseup","#titlebar",function(){i.titlebarMousedown=0,$(this)[0].releaseCapture&&$(this)[0].releaseCapture()}),$("body").on("click","#titlebar .actions a",function(e){var t=$(this).attr("class");"min"==t||"close"==t&&(window.location="byond://winset?"+i.window+".is-visible=false")}),i.noResize||($("body").on("mousemove","#resizeArea",function(e){if(!i.resizeWorking){if(i.resizeWorking=!0,e=e||window.event,1==i.resizeMousedown){var t=document.body.offsetWidth,o=document.body.offsetHeight,t=e.clientX>t?e.clientX:t-(t-e.clientX),o=e.clientY>o?e.clientY:o-(o-e.clientY);if(t<i.minWidth||o<i.minHeight)return void(i.resizeWorking=!1);window.location="byond://winset?"+i.window+".size="+t+"x"+o}i.resizeWorking=!1}}),$("body").on("mousedown","#resizeArea",function(){i.resizeMousedown=1,$(this)[0].setCapture&&$(this)[0].setCapture()}),$("body").on("mouseup","#resizeArea",function(){i.resizeMousedown=0,$(this)[0].releaseCapture&&$(this)[0].releaseCapture()})),$("#content > .nano-content").focus())});